{"version":3,"file":"pagination.middleware.js","sourceRoot":"","sources":["../../src/middleware/pagination.middleware.ts"],"names":[],"mappings":";;;;;;;;;;AACA,sDAA6C;AAC7C,wDAAwD;AACxD,0DAAyD;AAEzD,8BAAqC,MAAW,EAAE,WAAmB,EAAE,gBAA8C;IACnH,MAAM,CAAC;QACL,KAAK,EAAE,UAAgB,GAAG,IAAW;;gBACnC,IAAI,CAAC,IAAI,EAAE,KAAK,CAAC,GAAG,MAAM,gBAAgB,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;gBAEnE,MAAM,CAAC,qCAAkB,EAAE,CAAC,kBAAkB,CAAC,MAAM,CAAC;qBACnD,MAAM,CAAC,QAAQ,IAAI,QAAQ,CAAC,QAAQ,KAAK,WAAW,CAAC;qBACrD,GAAG,CAAC,QAAQ,IAAI,QAAQ,CAAC,SAAS,CAAC;qBACnC,GAAG,CAAC,cAAc;oBACjB,MAAM,gBAAgB,GAAG,cAAc;yBACpC,MAAM,CAAC,CAAC,QAAQ,EAAE,QAAQ;wBACzB,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC;wBACzC,MAAM,CAAC,QAAQ,CAAC;oBAClB,CAAC,EAAE,EAAiC,CAAC,CAAC;oBACxC,MAAM,CAAC,IAAI,oCAAkB,CAAC,KAAK,EAAE,IAAI,EAAE,IAAI,yBAAQ,CAAC,KAAK,EAAE,gBAAgB,CAAC,QAAQ,CAAC,EAAE,gBAAgB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;gBACzH,CAAC,CAAC;qBACD,IAAI,CAAC,CAAC,CAAC,EAAE,KAAK,KAAK,KAAK,KAAK,CAAC,CAAC,CAAC;YACrC,CAAC;SAAA;KACF,CAAC;AACJ,CAAC;AAnBD,oDAmBC","sourcesContent":["import { FieldMetadata } from '../metadata';\nimport { PageInfo } from '../page-info.type';\nimport { PaginationResponse } from '../pagination.type';\nimport { getMetadataBuilder } from '../metadata-builder';\n\nexport function PaginationMiddleware(target: any, propertyKey: string, methodDescriptor: TypedPropertyDescriptor<any>): any {\n  return {\n    value: async function (...args: any[]) {\n      let [data, count] = await methodDescriptor.value.apply(this, args);\n\n      return getMetadataBuilder().buildFieldMetadata(target)\n        .filter(metadata => metadata.property === propertyKey)\n        .map(metadata => metadata.arguments)\n        .map(fieldArguments => {\n          const paginationValues = fieldArguments\n            .reduce((indexMap, metadata) => {\n              indexMap[metadata.name] = metadata.index;\n              return indexMap;\n            }, {} as { [name: string]: number; });\n          return new PaginationResponse(count, data, new PageInfo(count, paginationValues['offset'], paginationValues['limit']));\n        })\n        .find((_, index) => index === 0);\n    },\n  };\n}\n"]}